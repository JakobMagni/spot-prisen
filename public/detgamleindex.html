
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="scripts/d3.js"></script>
  <link rel="stylesheet" href="style.css">
  <title>Postgres node.js template med d3.js</title>
</head>

<body>

  <div class="myDiv">
    <h2>This is a heading in a div element</h2>
    <p>This is some text in a div element.</p>
  </div>

  <div id="diagram1"></div>

  <script>
    /*
    // Denne query kører op imod API'en som findes i 'main.js'.

    d3.json("/api/elafgift", {
      method: "POST",
    }).then(function (response) {
      const data_elafgift = response.data; // Hent data ud af response
      console.log("elafgift", data_elafgift)
    })

    // Ugentlig gennemsnits max- og minpris
    d3.json("/api/avg_weekly", {
      method: "POST",
    }).then(function (response) {
      const data_avg_weekly = response.data; // Hent data ud af response
      console.log("Ugentlig gennemsnitsdata", data_avg_weekly)
    })


    // Gennemsnits timepris (2021)
    d3.json("/api/avg_timepris", {
      method: "POST",
    }).then(function (response) {
      const data_avg_hour = response.data; // Hent data ud af response
      console.log("Gennemsnits time pris", data_avg_hour)
    })


    // Query for tarif-data
    d3.json("/api/tarif_sum", {
      method: "POST",
    }).then(function (response) {
      const data_tarif = response.data; // Hent data ud af response
      console.log("tarif", data_tarif);})


       // Gennemsnits timepris (2021)
    d3.json("/api/avg_timepris", {
      method: "POST",
    }).then(function (response) {
      const data_avg_hour = response.data; // Hent data ud af response
      console.log("Gennemsnits time pris", data_avg_hour)
  


      

            //Definere højde, bredde og svg elements attributter 
            var width = 1000;
            var height = 400;
            var bottomPadding = 20;
            var svg = d3.select("#diagram1").append("svg").attr("width", width).attr("height", height);


            // Skalering 
            var xScale = d3.scaleBand().domain(d3.range(data_avg_hour.length + 1)).range([0, width]).paddingInner(0.1);
            var yScale = d3.scaleLinear().domain([0, d3.max(data_avg_hour, (d) => d.avg)]).range([height - 20, 0]);



            // Lave og placere akser (Y aksen)



            // Farver 
            var color = d3.scaleLinear()
                .domain([0, d3.max(data_avg_hour, (d) => d.avg)])
                .range(["#2bd6b4", "#5742f5"]);



            // Definere svg elementet som en variabel = bars og koble data og function for barer på 
            var bars = svg.selectAll()
                .data(data_avg_hour)
                .enter()
                .append("path")
                .attr("d", function (d) {
                    return bar(xScale(d.hour), yScale(0), xScale.bandwidth(), yScale(0) - yScale(0), 10);
                })
                .attr("fill", function (d) { return color(d.avg) })
                .transition()
                .duration(2000)
                .attr("d", function (d, i) {
                    return bar(xScale(i), yScale(0), xScale.bandwidth(), yScale(0) - yScale(data_avg_hour[i].avg), 10)
                })




            // Funktion som lager barer med afrundede kanter 
            function bar(x, y, w, h, r, f) {
                // Flag for sweep:
                if (f == undefined) f = 1;

                // x coordinates of top of arcs
                var x0 = x + r;
                var x1 = x + w - r;
                // y coordinates of bottom of arcs
                var y0 = y - h + r;
                // just for convenience (slightly different than above):
                var l = "L", a = "A";

                var parts = ["M", x, y, l, x, y0, a, r, r, 0, 0, f, x0, y - h, l, x1, y - h, a, r, r, 0, 0, f, x + w, y0, l, x + w, y, "Z"];
                return parts.join(" ");
            }



            const xAxis = d3.axisBottom().scale(xScale).ticks(data_avg_hour.length)
            svg.append("g") // "g" er en SVG Group
                // Aksen flyttes på plads med 'transform'
                .attr("transform", "translate(0," + (height - 20) + ")")
                // d3.js laver sin magi
                .call(xAxis);

/*

            // Still transitionable:
            /*  bars.data(data.reverse())
                .transition()
                .attr("d", function (d, i) {
                    return bar(xScale(i), yScale(0), xScale.bandwidth(), yScale(0) - yScale(d.avg), 30);
                })
                .duration(2000)
                .transition()
                .attr("d", function (d, i) {
                    return bar(xScale(i), yScale(0), xScale.bandwidth(), y(0) - yScale(d.avg), 0);
                })
                .duration(2000)
                .transition()
                .attr("d", function (d, i) {
                    return bar(xScale(i), yScale(0), xScale.bandwidth(), yScale(0) - yScale(d.avg), 15);
                })
                .duration(2000); */







      console.log("Loading complete")
      // Lav din egen visualsering med data her!
    

   
  </script>
</body>

</html>